# OpenHarmony学习文档
## 一、OpenHarmony简介与架构
### 1.1 OpenHarmony简介
OpenHarmony是由开放原子开源基金会（OpenAtom Foundation）孵化及运营的开源项目，目标是面向全场景、全连接、全智能时代，基于开源的方式，搭建一个智能终端设备操作系统开源平台，促进万物互联产业的繁荣发展。
### 1.2 OpenHarmony架构
OpenHarmony架构分为四个层级：内核层、系统服务层、框架层和应用层。
- 内核层：OpenHarmony内核层采用多内核设计，支持Linux、LiteOS、Windows等内核，并针对不同资源受限设备，通过轻量级内核、内核小型化、内核解耦等方案，为终端设备提供丰富的内核形态。
- 系统服务层：系统服务层为应用程序提供基础服务，包括分布式任务调度与通信、分布式数据管理、分布式设备管理、原子化服务管理等基础服务，以及升级维护、多模输入、图形、安全、AI等公共基础服务。
- 框架层：框架层为应用程序提供Java/C/C++/JS等多语言开发框架，支持图形、人工智能、音视频、通信等分布式能力，并支持分布式应用运行时环境。
- 应用层：应用层包括系统应用和第三方应用，提供全场景智慧服务，如智能家居、运动健康、影音娱乐等。
- OpenHarmony架构图如下：
![](../截图/1.png)
## 二、OpenHarmony开发环境搭建
### 2.1 环境要求
- 操作系统：Windows 10 64位、Ubuntu 18.04.4 64位、CentOS 7.6 64位
- 硬件要求：内存8GB及以上，硬盘120GB及以上
- 开发工具：DevEco Studio
### 2.2 开发环境搭建
- 下载DevEco Studio：访问OpenHarmony官网，下载DevEco Studio安装包。- 安装DevEco Studio：双击安装包，按照提示完成安装。
- 配置环境变量：将DevEco Studio安装目录下的tools文件夹路径添加到系统环境变量中。
- 创建OpenHarmony项目：打开DevEco Studio，选择File -> New -> New Project，按照提示创建OpenHarmony项目。
- 配置项目：在项目创建完成后，根据项目需求配置项目参数，如设备类型、屏幕尺寸、语言等。
- 编写代码：在项目目录下，根据项目需求编写代码。
- 编译运行：点击DevEco Studio工具栏上的Build按钮，编译项目。编译完成后，点击Run按钮，运行项目。
- 调试：点击DevEco Studio工具栏上的Debug按钮，进入调试模式，可以查看变量值、调用栈等信息。
- 打包：点击DevEco Studio工具栏上的Build -> Build Bundle(s)/App(s)按钮，打包项目。
- 部署：将打包后的文件部署到目标设备上，运行项目。
- 更多开发环境搭建信息，请参考OpenHarmony官方文档。
## 三、OpenHarmony开发入门
### 3.1 开发语言
- Java：适用于开发OpenHarmony应用层应用。
- C/C++：适用于开发OpenHarmony系统服务层和框架层应用。
- JS：适用于开发OpenHarmony应用层应用。
- ArkTs：适用于开发OpenHarmony应用层应用，提供TypeScript语言支持。
- ArkUI：适用于开发OpenHarmony应用层应用，提供声明式UI开发框架。
### 3.2 开发工具
- DevEco Studio：OpenHarmony官方提供的集成开发环境，支持Java、C/C++、JS等多种开发语言。
- HUAWEI DevEco Device Tool：OpenHarmony官方提供的设备调试工具，支持OpenHarmony设备的调试和烧录。
- HUAWEI DevEco Compiler：OpenHarmony官方提供的编译工具，支持OpenHarmony项目的编译。
- HUAWEI DevEco Inspector：OpenHarmony官方提供的性能分析工具，支持OpenHarmony应用的性能分析。
### 3.3 开发流程
1. 创建项目：使用DevEco Studio创建OpenHarmony项目。
2. 配置项目：根据项目需求配置项目参数，如设备类型、屏幕尺寸、语言等。
3. 编写代码：根据项目需求编写代码，可以使用Java、C/C++、JS等多种开发语言。
4. 编译项目：使用DevEco Studio编译项目，生成可执行文件。
5. 部署项目：将编译后的文件部署到目标设备上，运行项目。
6. 调试项目：使用DevEco Studio调试项目，查看变量值、调用栈等信息。
7. 性能分析：使用HUAWEI DevEco Inspector进行性能分析，优化应用性能。
8. 打包项目：使用DevEco Studio打包项目，生成可安装文件。
9. 发布项目：将打包后的文件发布到应用市场，供用户下载安装。
10. 维护项目：根据用户反馈，持续优化和更新项目。
## 四、OpenHarmony的重点技术
### 4.1 原子化服务
#### 4.1.1 免安装+秒级启动
- 原子化服务可以在后台自动完成部署，后台智能清理低频使用的服务，能够减少存储空间占用，提升系统流畅度。
- 原子化服务有灵活的服务卡片，服务卡片是原子化服务的入口，可以在桌面、应用市场、搜索等场景中展示，用户可以点击卡片快速启动服务。服务卡片支持自定义样式，可以根据应用需求展示不同的内容，如图片、文字、按钮等。
- 原子化服务在云端进行打包和部署，通过CDN分发到设备端，没有应用图标，卡片直接触发服务，大大提升了开发者上架应用的分发效率和转化率。
#### 4.1.2 一次开发，多端部署
- 原子化服务支持一次开发，多端部署，开发者只需要编写一次代码，就可以在多个设备上运行，如手机、平板、智能手表、智能音箱等。
- 原子化服务支持跨设备协同，可以在多个设备上共享数据，如联系人、日历、音乐等，提升用户体验。
- 原子化服务支持跨设备通信，可以在多个设备上实现实时通信，如视频通话、语音通话等。
- 原子化服务提供了统一的应用程序框架，开发者可以使用Java、C/C++、JS等多种开发语言，根据设备类型和平台差异，选择合适的开发语言和框架，提高了运行效率和兼容性。
#### 4.1.3分布式流转能力
- 原子化服务支持分布式流转能力，可以在多个设备之间实现数据流转，如文件传输、图片分享等，提升了用户体验。
- 原子化服务支持分布式数据库，可以在多个设备上共享数据，如联系人、日历、音乐等，提升了数据一致性和可靠性。
- 原子化服务支持分布式计算，可以在多个设备上并行计算，如视频剪辑、图像处理等，提升了计算效率和性能。
- 原子化服务支持分布式存储，可以在多个设备上共享存储空间，如文件、图片、视频等，提升了存储效率和容量。
- 原子化服务支持分布式网络，可以在多个设备上共享网络资源，如Wi-Fi、蓝牙、NFC等，提升了网络连接稳定性和速度。
- 原子化服务支持分布式安全，可以在多个设备上共享安全策略，如身份认证、权限管理等，提升了数据安全和隐私保护。
- 原子化服务支持分布式备份、恢复、迁移等，可以在多个设备上并行备份、恢复、迁移应用数据，如联系人、日历、音乐等，提升了数据效率和可靠性。
- 原子化服务支持分布式协同，可以在多个设备上并行协同工作，如多人协作、实时编辑等，提升了协同效率和用户体验。
#### 4.1.4以人为中心的设计理念
- 原子化服务支持个性化推荐，根据用户喜好和需求，推荐合适的服务和内容，提升用户体验。
- 原子化服务支持智能语音助手，通过语音识别和自然语言处理技术，实现语音交互和智能控制，提升用户体验。
#### 4.1.5原子化服务的缺点
- 原子化服务不支持传统应用商店的下载、更新、卸载等，用户无法通过应用商店安装、更新和卸载原子化服务。
- 原子化服务不支持传统应用的权限管理，用户无法通过系统设置管理原子化服务的权限。
- 由于免安装的HAP包的大小不能超过10MB，所以一些大型的应用无法使用原子化服务，限制了功能复杂的服务。
- 服务的快速部署和流转需要依赖分布式软总线，而分布式软总线目前只支持局域网内的设备，限制了服务的流转范围。
- 服务的快速部署和流转需要更严格的安全策略，以防止恶意代码的传播和攻击，保护用户的隐私。
### 4.2硬件资源池
OpenHarmony的硬件资源池是将设备上的硬件资源抽象化，形成一个“超级虚拟设备”，资源可以被不同应用按需访问和组合，从而实现“一对多”的硬件资源访问。
#### 4.2.1分布式硬件框架
- 分布式硬件框架包括分布式硬件管理、分布式硬件驱动、分布式硬件服务、分布式硬件接口等模块。
- 分布式硬件框架对硬件资源的信息管理包括接入管理、状态管理、权限管理、版本管理等。
#### 4.2.2设备管理
- 设备管理包括设备发现、设备连接、设备管理等功能。
- 设备发现：通过分布式软总线，可以快速发现局域网内的其他设备。
- 设备连接：通过分布式软总线，可以快速连接到其他设备，实现设备间的通信。
- 设备管理：可以管理设备的连接状态、设备信息、设备权限等。
#### 4.2.3硬件驱动框架（HDF）
- 硬件驱动框架（HDF）是OpenHarmony的硬件抽象层，它将硬件资源抽象化为统一的接口，提供统一的硬件驱动接口和配置管理机制。
- 硬件驱动框架（HDF）通过消息模型库，提供驱动程序与硬件设备之间的通信机制。
- 硬件驱动框架（HDF）通过适配层、管理模块、驱动模块、测试模块等模块，实现硬件资源的统一管理和驱动也就是HDF的核心代码。
- 硬件驱动框架（HDF）通过传感器、显示、输入等，提供通用的驱动框架和模块。
#### 4.2.4分布式服务
为应用提供多种分布式能力，如：
- 分布式相机：支持多设备协同拍照、视频录制等，具有设备共享相机能力。
- 分布式屏幕：支持多设备协同显示，具有设备共享屏幕和扩展能力。
- 分布式音频：支持音频在多设备之间无缝流转，具有设备共享音频能力。
#### 4.2.5多层架构设计与硬件适配
- 硬件资源抽象层：抽象不同设备的硬件能力，提供统一接口供上层应用调用，从而屏蔽了硬件差异。
- 操作系统适配层：提供封装的内核操作API，从而屏蔽不同操作系统的差异。
- 平台驱动层：提供统一API，用于访问硬件资源，从而支持多种硬件设备的驱动开发。
#### 4.2.6缺点
- 由于复杂的分布式技术和基于分布式软总线的底层通信支持，硬件资源池的部署和开发难度较大，系统的复杂性增加。
- 依赖于OpenHarmony生态，硬件资源池的兼容性和可扩展性受到限制。
- 资源的共享与协同需要严格的安全策略，以防止恶意代码的传播和攻击，防止数据泄露和未经授权的访问。
### 4.3分布式软总线
#### 4.3.1适配层与框架层
- 适配层：提供统一的接口，用于访问不同网络协议和传输方式，实现设备间的数据传输。
- 框架层：提供统一的接口，用于管理设备间的连接和拓扑关系，实现设备间的自动发现和连接。
#### 4.3.2设备发现
- 通过Wi-Fi、蓝牙、NFC等通信方式，可以满足不同场景下的设备发现和连接需求，实现设备间的自动发现和连接（设备必须处于同一网络环境中）。
#### 4.3.3组网与拓扑管理
- 通过本地网络等服务接口管理设备间的连接和拓扑关系，提供了统一的组网能力，可以实现设备间的自动发现和连接。
- 设备可以随时加入或者离开网络，每一个设备既可以作为网络节点，也可以作为网关。
#### 4.3.4数据传输
- 通过分布式软总线，可以实现设备间的数据传输，包括文件传输、数据共享等。
- 分布式软总线支持多种数据传输协议，包括TCP、UDP、HTTP等。
- 分布式软总线支持多种数据传输方式，包括点对点传输、广播传输、组播传输等。
- 分布式软总线支持多种数据传输格式，包括二进制、JSON、XML等。
- 分布式软总线支持多种数据传输安全机制，包括加密、认证、授权等。
- 分布式软总线支持多种数据传输性能优化机制，包括压缩、缓存、优先级等。
- 分布式软总线支持多种数据传输错误处理机制，包括重传、超时、丢弃等。
- 分布式软总线支持多种数据传输监控机制，包括流量监控、带宽监控、延迟监控等。
#### 4.3.5缺点
- 分布式软总线依赖于OpenHarmony生态，硬件资源池的兼容性和可扩展性受到限制。
- 由于复杂的分布式技术和基于分布式软总线的底层通信支持，硬件资源池的部署和开发难度较大，系统的复杂性增加。
- 由于多设备协同场景，会对设备的计算和网络资源造成较大压力，需要考虑设备的性能和功耗。

